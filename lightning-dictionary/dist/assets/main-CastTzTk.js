var I=Object.defineProperty;var B=(p,t,s)=>t in p?I(p,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[t]=s;var v=(p,t,s)=>B(p,typeof t!="symbol"?t+"":t,s);import{r as d,l as g,i as b,j as e,R as D,a as J}from"./event-GvlrvNPL.js";class O{constructor(){v(this,"marks",new Map);v(this,"metrics",[])}mark(t){this.marks.set(t,performance.now())}measure(){const t=this.marks.get("hotkey-pressed"),s=this.marks.get("text-captured"),r=this.marks.get("cache-lookup"),u=this.marks.get("api-call"),x=this.marks.get("render-start"),c=this.marks.get("render-complete");if(!t||!s||!r||!x||!c)return console.error("Missing performance marks"),null;const n={hotkeyPressed:0,textCaptured:s-t,cacheLookup:r-s,apiCall:u?u-r:void 0,renderStart:x-(u||r),renderComplete:c-x,totalTime:c-t};return this.metrics.push(n),this.marks.clear(),n}getStats(){if(this.metrics.length===0)return{count:0,avgTotal:0,minTotal:0,maxTotal:0,p50Total:0,p95Total:0,p99Total:0,breakdown:{textCapture:0,cacheLookup:0,apiCall:0,rendering:0}};const t=this.metrics.map(n=>n.totalTime).sort((n,l)=>n-l),s=t.length,r=this.metrics.reduce((n,l)=>n+l.textCaptured,0)/s,u=this.metrics.reduce((n,l)=>n+l.cacheLookup,0)/s,x=this.metrics.filter(n=>n.apiCall).reduce((n,l)=>n+(l.apiCall||0),0)/this.metrics.filter(n=>n.apiCall).length||0,c=this.metrics.reduce((n,l)=>n+l.renderComplete,0)/s;return{count:s,avgTotal:t.reduce((n,l)=>n+l,0)/s,minTotal:t[0],maxTotal:t[s-1],p50Total:t[Math.floor(s*.5)],p95Total:t[Math.floor(s*.95)],p99Total:t[Math.floor(s*.99)],breakdown:{textCapture:r,cacheLookup:u,apiCall:x,rendering:c}}}exportCSV(){const t=["timestamp","textCaptured","cacheLookup","apiCall","renderStart","renderComplete","totalTime"],s=this.metrics.map(r=>[new Date().toISOString(),r.textCaptured,r.cacheLookup,r.apiCall||"N/A",r.renderStart,r.renderComplete,r.totalTime]);return[t,...s].map(r=>r.join(",")).join(`
`)}reset(){this.metrics=[],this.marks.clear()}}const f=new O;function H(){const[p,t]=d.useState(""),[s,r]=d.useState(null),[u,x]=d.useState(!1),[c,n]=d.useState(null),[l,F]=d.useState(null),[M,j]=d.useState(null),[y,P]=d.useState(""),[k,C]=d.useState(null),[T,_]=d.useState(!1),[a,L]=d.useState(null);d.useEffect(()=>{const o=g("word-definition",i=>{console.log("Word definition event:",i.payload),f.mark("render-start");const h=i.payload;t(h.word),r(h.definition),j(h.from_cache),F(h.lookup_time_ms),requestAnimationFrame(()=>{f.mark("render-complete");const R=f.measure();R&&console.log(`Total E2E time: ${R.totalTime.toFixed(2)}ms`)})}),m=g("clipboard-definition",i=>{console.log("Clipboard definition event:",i.payload);const h=i.payload;t(h.word),r(h.definition),j(h.from_cache)}),w=g("no-selection",()=>{console.log("No text selected")}),E=g("wayland-detected",()=>{console.log("Running on Wayland - showing alternative instructions"),x(!0)}),z=g("clipboard-word",i=>{console.log("Clipboard word detected:",i.payload),t(i.payload),r(null),j(!1)});return S(),()=>{o.then(i=>i()),m.then(i=>i()),w.then(i=>i()),E.then(i=>i()),z.then(i=>i())}},[]);const S=async()=>{try{const o=await b("cache_stats");n(JSON.parse(o))}catch(o){console.error("Failed to load cache stats:",o)}},A=async()=>{try{const o=await b("get_performance_stats"),m=f.getStats();L({backend:o,frontend:m})}catch(o){console.error("Failed to load performance stats:",o)}},W=async()=>{try{await b("reset_performance_stats"),f.reset(),L(null)}catch(o){console.error("Failed to reset performance stats:",o)}},N=async()=>{if(y.trim()){C(null),_(!0);try{const o=performance.now(),m=await b("lookup_word",{word:y}),w=performance.now()-o;m.success&&m.data?(t(y),r(m.data),F(w),j(!0),C(null)):(r(null),C(m.error||"Word not found")),await S()}catch(o){console.error("Lookup error:",o),C("Failed to connect to dictionary service"),r(null)}finally{_(!1)}}};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"âš¡ Lightning Dictionary - Cache Test"}),e.jsxs("div",{className:"test-section",style:{marginBottom:"2rem",padding:"1rem",border:"2px dashed #666",borderRadius:"8px"},children:[e.jsx("h3",{children:"ğŸ§ª Cache Testing"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("input",{type:"text",value:y,onChange:o=>P(o.target.value),placeholder:"Enter a word to test cache",style:{flex:1,padding:"0.5rem"},onKeyDown:o=>o.key==="Enter"&&N()}),e.jsx("button",{onClick:N,disabled:T,style:{padding:"0.5rem 1rem"},children:T?"Loading...":"Test Lookup"}),e.jsx("button",{onClick:S,style:{padding:"0.5rem 1rem"},children:"Refresh Stats"})]}),c&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"#888"},children:[e.jsx("p",{children:"ğŸ“Š Cache Stats:"}),e.jsxs("ul",{style:{listStyle:"none",paddingLeft:"1rem"},children:[e.jsxs("li",{children:["â€¢ Size: ",c.size,"/",c.capacity," words"]}),e.jsxs("li",{children:["â€¢ Memory: ~",(c.memory_usage_estimate/1024/1024).toFixed(2)," MB"]})]})]})]}),p&&e.jsxs("div",{className:"definition-card",children:[e.jsx("h2",{className:"word",children:p}),k?e.jsxs("div",{style:{color:"#e74c3c",padding:"1rem",textAlign:"center"},children:[e.jsxs("p",{children:["âš ï¸ ",k]}),k.includes("internet")&&e.jsx("p",{style:{fontSize:"0.9rem",marginTop:"0.5rem"},children:"Please check your connection and try again."})]}):s?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"part-of-speech",children:s.pos}),s.pronunciation&&e.jsx("p",{className:"pronunciation",children:s.pronunciation}),e.jsx("ul",{className:"definitions",children:s.definitions.map((o,m)=>e.jsx("li",{children:o},m))})]}):T?e.jsx("p",{className:"definition",children:"Loading..."}):e.jsx("p",{className:"definition",children:"No definition in cache (cache miss)"}),l!==null&&!k&&e.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.8rem",color:"#666"},children:[e.jsxs("p",{children:["â±ï¸ Lookup time: ",l.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸ’¾ Source: ",M?"Cache (HIT)":"Not in cache (MISS)"]})]})]}),e.jsxs("div",{className:"status",children:[u?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"âš ï¸ Running on Wayland - Global hotkeys are not supported"}),e.jsx("p",{children:"âœ… Clipboard monitoring is active!"}),e.jsx("p",{children:"âœ¨ Copy any single word to look it up automatically"})]}):e.jsxs("p",{children:["âœ¨ Press ",e.jsx("kbd",{children:"Alt"}),"+",e.jsx("kbd",{children:"J"})," or ",e.jsx("kbd",{children:"Ctrl"}),"+",e.jsx("kbd",{children:"Shift"}),"+",e.jsx("kbd",{children:"D"})," on any selected text!"]}),e.jsx("p",{className:"stats",children:c?`Cache: ${c.size} words loaded â€¢ Target: <50ms response`:"Loading cache stats..."})]}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"#1a1a1a",borderRadius:"8px",border:"1px solid #333"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"ğŸš€ Performance Metrics"}),e.jsxs("div",{children:[e.jsx("button",{onClick:A,style:{marginRight:"0.5rem",padding:"0.5rem 1rem"},children:"Load Stats"}),e.jsx("button",{onClick:W,style:{padding:"0.5rem 1rem"},children:"Reset"})]})]}),a&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#222",borderRadius:"4px"},children:[e.jsx("h4",{style:{marginTop:0},children:"Backend Performance"}),a.backend.count>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["ğŸ“Š Total Lookups: ",a.backend.count]}),e.jsxs("p",{children:["âš¡ Average Time: ",a.backend.avg_total_ms.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸƒ Min/Max: ",a.backend.min_total_ms.toFixed(2),"ms / ",a.backend.max_total_ms.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸ“ˆ P95: ",a.backend.p95_total_ms.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸ’¾ Cache Hit Rate: ",a.backend.cache_hit_rate.toFixed(1),"%"]}),e.jsx("hr",{style:{margin:"0.5rem 0",opacity:.3}}),e.jsx("p",{style:{fontSize:"0.9rem"},children:"Breakdown:"}),e.jsxs("ul",{style:{listStyle:"none",paddingLeft:"1rem",fontSize:"0.9rem"},children:[e.jsxs("li",{children:["â€¢ Text Capture: ",a.backend.breakdown.text_capture_ms.toFixed(2),"ms"]}),e.jsxs("li",{children:["â€¢ Cache Lookup: ",a.backend.breakdown.cache_lookup_ms.toFixed(2),"ms"]}),e.jsxs("li",{children:["â€¢ API Call: ",a.backend.breakdown.api_call_ms.toFixed(2),"ms"]})]})]}):e.jsx("p",{style:{color:"#666"},children:"No data yet. Try some lookups!"})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"#222",borderRadius:"4px"},children:[e.jsx("h4",{style:{marginTop:0},children:"Frontend Performance"}),a.frontend.count>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["ğŸ“Š Total Renders: ",a.frontend.count]}),e.jsxs("p",{children:["âš¡ Average E2E: ",a.frontend.avgTotal.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸƒ Min/Max: ",a.frontend.minTotal.toFixed(2),"ms / ",a.frontend.maxTotal.toFixed(2),"ms"]}),e.jsxs("p",{children:["ğŸ“ˆ P95: ",a.frontend.p95Total.toFixed(2),"ms"]}),e.jsx("p",{style:{color:a.frontend.avgTotal<50?"#4CAF50":"#FF9800",fontWeight:"bold",marginTop:"0.5rem"},children:a.frontend.avgTotal<50?"âœ… Meeting <50ms target!":"âš ï¸ Above 50ms target"}),e.jsx("hr",{style:{margin:"0.5rem 0",opacity:.3}}),e.jsx("p",{style:{fontSize:"0.9rem"},children:"Breakdown:"}),e.jsx("ul",{style:{listStyle:"none",paddingLeft:"1rem",fontSize:"0.9rem"},children:e.jsxs("li",{children:["â€¢ Rendering: ",a.frontend.breakdown.rendering.toFixed(2),"ms"]})})]}):e.jsx("p",{style:{color:"#666"},children:"No data yet. Try some lookups!"})]})]})]}),e.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"#f0f0f0",borderRadius:"8px",color:"#333"},children:[e.jsx("h4",{children:"ğŸ“ Testing Instructions:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Try looking up words using the test input above"}),e.jsx("li",{children:"Select text in any application and press Alt+J"}),e.jsx("li",{children:"Watch the console for debug output"}),e.jsx("li",{children:"Note: Cache is empty until you add test data"})]})]})]})}D.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(H,{})}));
